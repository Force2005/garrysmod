--@name Loud Music21
--@author Markiz red by Force
--@shared
--@model models/sligwolf/grocel/radio/gramophone.mdl

local Volume = 0.4
local Speed = 1
local URL = "sh"
local IsLooping = true
local RestartAfterPause = false
local StartTime = 0

local IsAllServer = false
local Radius = 2000

------------------------------------------------------------------------------------


--local Target = find.playersByName("Markiz")[1]
/*AFK = find.allPlayers(function(p)
    if p:getSteamID() == "STEAM_0:0:582893321" then
        return true
    end
end)[1]*/
--print(Target)

--if Target ~= nil and player() ~= Target then return end

--if player() == Target then return end

------------------------------------------------------------------------------------

local _urls = {
    sh = "https://cdn.discordapp.com/attachments/1202316619951382598/1238502123852005406/Vakhbet_Abedov_-_SHaurma_51924809.mp3?ex=663f847c&is=663e32fc&hm=22f37214ab64cd5a03b2be9f4c75a65c014c6b701e6f224ce9e6a0df6cb03c9c&",
    d = "https://cdn.discordapp.com/attachments/1216055783045992538/1238479411851034624/-_.mp3?ex=663f6f55&is=663e1dd5&hm=cd64c00d97e05bfcdd188f73fe8b3a6a2a10114e1a0884a4e25d52719d1f9c0d&",
    i = "https://cdn.discordapp.com/attachments/1202316619951382598/1238471561338552371/semmmyq_shinra_-_untitled.mp3?ex=663f6805&is=663e1685&hm=e4ff00efa62b232ec9c0745a1087287c2aa979f88bebd3e4931adc1bdf9514d9&",
    hps = "https://cdn.discordapp.com/attachments/1202316619951382598/1238469814826045440/Undertale_-_Hopes_and_Dreams_Save_the_World_His_Theme_Last_Goodbye____Mr._Feral_.mp3?ex=663f6665&is=663e14e5&hm=f047619f53e98e8722136c234a57ea82dcf6d57c4a752f6d918b7022d69b3060&",
    ss = "https://cdn.discordapp.com/attachments/1216055783045992538/1238469217754284092/Toby_Fox_-_Vs._Susie.mp3?ex=663f65d7&is=663e1457&hm=b60d1a93a99854ddb6f2f4e0103192875b00731d6653e79b4a333223b59d651c&",
    field = "https://cdn.discordapp.com/attachments/1216055783045992538/1238217557543227495/Toby_Fox_-_Field_of_Hopes_and_Dreams.mp3?ex=663e7b76&is=663d29f6&hm=de77f98637787fdd07a9ee6290eb71e465e8280b51bd98b62e580ae5dadc43c2&",
    pnd = "https://cdn.discordapp.com/attachments/1216055783045992538/1238214996769378375/Toby_Fox_-_Pandora_Palace.mp3?ex=663e7914&is=663d2794&hm=1c7ba8b54cc073028a3e5d5ac66c42d93fcc47c92a01f68329bfd8b3ec5d15e7&",
    grl = "https://cdn.discordapp.com/attachments/1216055783045992538/1238214452432605184/Toby_Fox_-_Girl_Next_Door.mp3?ex=663e7892&is=663d2712&hm=9417cf3971c4d14185f266feecaa967ca5b52da8b9c9d49aa95fcbb1ddae6236&",
    ralsei = "https://cdn.discordapp.com/attachments/1216055783045992538/1238213940194971759/Toby_Fox_-_My_Castle_Town.mp3?ex=663e7818&is=663d2698&hm=4b29f3e2976c6c0c34d6aa3e711a33d4b430108d61d4436d933064efc439a11e&",
    posos = "https://cdn.discordapp.com/attachments/1216055783045992538/1238211731885391982/MORGENSHTERN_-_.mp3?ex=663e7609&is=663d2489&hm=27ab5a85522b5106b63d18c31b0ff354fa3e5ca7a9b042091bb8f9f7fc75bded&",
    win = "https://cdn.discordapp.com/attachments/1216055783045992538/1238116706803777627/2024__Windows95man_-_No_Rules.mp3?ex=663e1d89&is=663ccc09&hm=fc44b86973bbccd2e6290a5753e9de0de334ea45e9a54e58bd8bf7f11d27a69a&",
    vang = "https://cdn.discordapp.com/attachments/1216055783045992538/1237439763309531237/Fulgenesis_-__OST_Metal_Cover.mp3?ex=663ba716&is=663a5596&hm=7e99177198c8a1fc56ce7dedfe6873892ec0891ffbe6008dc26dd7ce25eeb861&",
    bitrd = "https://cdn.discordapp.com/attachments/1216055783045992538/1236757182431756328/-_2.mp3?ex=66392b62&is=6637d9e2&hm=4b4c23ee5a6092050d4906795a3eb61b8a7d8b5667072008224ae9ed1846a288&",
    andry = "https://cdn.discordapp.com/attachments/1216055783045992538/1236756671444029563/-_.mp3?ex=66392ae8&is=6637d968&hm=0b32ffd4d9c415c8076b4123a48a2cadb7445589945292754e34d99c71ac9423&",
    secret = "https://cdn.discordapp.com/attachments/1216055783045992538/1233448475065188484/-_-.mp3?ex=662d21e8&is=662bd068&hm=1a45ce62aa4ec3332e87cd4638c5dec04eba8155058d53b532a71d3a9461e937&",
    sidor = "https://cdn.discordapp.com/attachments/1216055783045992538/1231577248948289599/Firelake_-_Dirge_For_The_Planet.mp3?ex=663776b1&is=662501b1&hm=76342f330580d94b8793717b87f6d722f8faf0c361818e5a602ba48882a6e50e&",
    kom = "https://cdn.discordapp.com/attachments/1216055783045992538/1230576925177811094/Kirov_Reporting_-_125__.mp3?ex=6633d311&is=66215e11&hm=d0aec754749a66df2b84f7c351fd86d0ee7b4a855f0e8ddc6e8bf430999bd8ab&",
    ding = "https://cdn.discordapp.com/attachments/1216055783045992538/1229822913318748191/Surasshu_-_The_Penis_Eek_boykisser_theme.mp3?ex=663114d7&is=661e9fd7&hm=d53bde06fc8b5b88628e6111c0c1610f5d3a18b30fe5c19d0a84be87d8f40e91&",
    alw = "https://cdn.discordapp.com/attachments/1216055783045992538/1229435477061406791/Total_Pop_The_First_40_Hits_Deluxe_EditionRemastered_Erasure_Always.mp3?ex=662fac03&is=661d3703&hm=400cb05b162fcb0db54b5e77a801db74e34feab4896c14a3c916c5ec3f0b7398&",
    q = "https://cdn.discordapp.com/attachments/1216055783045992538/1229428235759128666/2_Brothers_On_The_4th_Floor_-_Dreams_Will_Come_Alive.mp3?ex=662fa545&is=661d3045&hm=e13466a3cb9acc737b48c9156f57fb9e34579c4cff3ed2a5e156163e10147a16&",
    chsv = "https://cdn.discordapp.com/attachments/1216055783045992538/1229165857859702794/Lida_-_.mp3?ex=662eb0e9&is=661c3be9&hm=edd5dcaeb0023a4ad47bf764d747bce4b57d47c97c093dc732b340768fa62220&",
    sereb = "https://cdn.discordapp.com/attachments/1216055783045992538/1228719611201978389/SEREBRO_-_Hardstyle_Remix_.mp3?ex=662d114f&is=661a9c4f&hm=2d70f5fbc979ad4a7542548e8fd1bf852609d98366758c772474753373b196fe&",
    sahr = "https://cdn.discordapp.com/attachments/1216055783045992538/1228712763594113024/-_2.mp3?ex=662d0aef&is=661a95ef&hm=fafae3b068452f536957362b9a8ac354a5e1f09e65c52d017ee0978c50bed108&",
    khnight = "https://cdn.discordapp.com/attachments/1089254454777360524/1228450588724039744/-_.mp3?ex=662c16c3&is=6619a1c3&hm=5c8d42f5799432720a365e0f4d312d78f36d1e568a01214e64b4c44cf9d80d81&",
    shkolnik = "https://cdn.discordapp.com/attachments/1089254454777360524/1228071123225411604/-_.mp3?ex=662ab55c&is=6618405c&hm=80f245b7e1029d4455aba757999cdf13492b64e363cc7e44f934ac97c4fa44b0&",
    shuht = "https://cdn.discordapp.com/attachments/1216055783045992538/1228059288753143881/Rammstein_-_Sehnsucht.mp3?ex=662aaa56&is=66183556&hm=873f4dafb31d7972c8840d94d121718f5ea149f4690ccd0052cffe4a922956d8&",
    stereo = "https://cdn.discordapp.com/attachments/1216055783045992538/1228050873448665139/remix_128147_-_Stereo_love.mp3?ex=662aa280&is=66182d80&hm=b34a5b695971e2d29d287a1ec2b9d5d123b3befd13859f82b6c70517296edd42&",
    grave = "https://cdn.discordapp.com/attachments/1216055783045992538/1227343767544139856/17067941342000.mp3?ex=66280ff5&is=66159af5&hm=3e2b4f8607e8ea163090b729942f86edaf1776de0c9098965440503d2022cf72&",
    mach = "https://cdn.discordapp.com/attachments/1081967820172181578/1201213079480967229/DAZI_-_Machiavelli_1.mp3",
    terpi = "https://cdn.discordapp.com/attachments/1081967820172181578/1200462883981631598/mz_-_.mp3",
    sam = "https://cdn.discordapp.com/attachments/1081967820172181578/1152968516962615356/Serious_Sam_HD_TFE_OST_-_War_1.mp3",
    hf = "https://cdn.discordapp.com/attachments/1081967820172181578/1114222009635835995/H-E-L-L-F-I-R-E.mp3",
    relax = "https://cdn.discordapp.com/attachments/1081967820172181578/1113194970065670154/Dabro_-_.mp3",
    dmdp = "https://cdn.discordapp.com/attachments/1081967820172181578/1112365376253198386/Sou_-_Dead_Mount_Death_Play_OPAnimeNewMusic.mp3",
    rap = "https://cdn.discordapp.com/attachments/1081967820172181578/1110264422326345929/-_.mp3",
    mshp = "https://cdn.discordapp.com/attachments/1081967820172181578/1109490273479819264/--.mp3",
    nayt = "https://cdn.discordapp.com/attachments/1081967820172181578/1109215109454254170/-_.mp3",
    sponge = "https://cdn.discordapp.com/attachments/1081967820172181578/1108494625104199821/-_.mp3",
    DF = "https://cdn.discordapp.com/attachments/1081967820172181578/1108493052869345331/DragonForce_-_Symphony_of_the_Night.mp3",
    itm = "https://cdn.discordapp.com/attachments/1081967820172181578/1104870354570199090/Itai_The_Maid_-_02_03.mp3",
    ynt = "https://cdn.discordapp.com/attachments/1081967820172181578/1104488993799798784/-__.mp3",
    aria = "https://cdn.discordapp.com/attachments/1081967820172181578/1104352781306957825/-_.mp3",
    webgrl = "https://cdn.discordapp.com/attachments/1081967820172181578/1104157838936387675/Itai_The_Maid_-_Webgirl_2_.mp3",
    otm = "https://cdn.discordapp.com/attachments/1081967820172181578/1100424250025840765/Ozoi_The_Maid_Yakui_The_Maid_-_Bayan_Bonus_Track.mp3",
    ff = "https://cdn.discordapp.com/attachments/1081967820172181578/1099699301770338304/Ozoi_The_Maid_Yakui_The_Maid_-_Faraway.mp3",
    az = "https://cdn.discordapp.com/attachments/1081967820172181578/1099700543519215676/Itai_The_Maid_-_Azoera.mp3",
    shalt = "https://cdn.discordapp.com/attachments/1081967820172181578/1099767485651226684/shaltai-boltai-vsiu-seriiu-vytianul_tkn2s9T.mp3",
    ar = "https://cdn.discordapp.com/attachments/1081967820172181578/1099709842320527502/-_.mp3",
    fn = "https://cdn.discordapp.com/attachments/1081967820172181578/1099705174836129912/-_.mp3",
    bam = "https://cdn.discordapp.com/attachments/1081967820172181578/1096924000879382641/-_.mp3",
    sanya1 = "https://cdn.discordapp.com/attachments/952924658456494111/1072894410104242176/-Mood-_full_.mp3",
    goosling = "https://cdn.discordapp.com/attachments/846689259851350027/1072844386657894490/College_amp_Electric_Youth_-_A_Real_Hero.mp3",
    hz = "https://cdn.discordapp.com/attachments/952924658456494111/1056845811318784061/Omission-Huma-Huma.mp3",
    glorx = "https://cdn.discordapp.com/attachments/846689259851350027/1030814871853481994/Forsaken_Music_-_Glorx.mp3",
    tenb = "https://u.teknik.io/LKjOg.mp3",
    koshmar = "https://u.teknik.io/P52iG.mp3",
    putnik = "https://u.teknik.io/GmK7o.mp3",
    siski = "https://cdn.discordapp.com/attachments/846689259851350027/1028303670862938162/-_.mp3",
    ban = "https://cdn.discordapp.com/attachments/846689259851350027/1028302724669915136/Unknown_artist_-__-__-_.mp3",
    les = "https://cdn.discordapp.com/attachments/846689259851350027/1028291212656001054/FIASKO_-_THE_METAL_SHEET_WiBBLE_WABBLE_1.mp3",
    dt2 = "https://cdn.discordapp.com/attachments/846689259851350027/1026112843977867284/CoMa_Electronic_ft._Feint_-_Snake_Eyes__cut_version__.mp3",
    zebr = "https://cdn.discordapp.com/attachments/846689259851350027/1025867663299330109/Zebrahead_-_Dissatisfied_1.mp3",
    miko = "https://cdn.discordapp.com/attachments/846689259851350027/1025715391831478282/-_INCELCORE.mp3",
    anim = "https://cdn.discordapp.com/attachments/846689259851350027/1025489129833779270/-.mp3",
    gachi = "https://cdn.discordapp.com/attachments/846689259851350027/1025448748131811348/DEAD_BLONDE_-_Right_Version_1.mp3",
    phonk = "https://cdn.discordapp.com/attachments/846689259851350027/1025104962105114705/ZODIVK_-_Devil_Eyes.mp3",
    coolio = "https://cdn.discordapp.com/attachments/846689259851350027/1025085081783631912/Coolio_feat._L.V._-_Gangstas_Paradise_feat._L.V._1.mp3",
     fart = "https://cdn.discordapp.com/attachments/846689259851350027/1024382685990371368/minecraft_-_fart_meme_21_bababooey.mp3",
    ryku = "https://cdn.discordapp.com/attachments/846689259851350027/1024360143565111326/----_-_.mp3",
    sektor = "https://cdn.discordapp.com/attachments/846689259851350027/1023316541028188271/-_1.mp3",
    yak = "https://cdn.discordapp.com/attachments/846689259851350027/1023315337124511824/-_.mp3",
    kolhoz = "https://cdn.discordapp.com/attachments/846689259851350027/1023248279795933254/-_.mp3",
    ment = "https://cdn.discordapp.com/attachments/846689259851350027/1023247445125255218/-_.mp3",
    rozhdestvo = "https://cdn.discordapp.com/attachments/846689259851350027/1023246175375196250/-_1.mp3",
    sk = "https://cdn.discordapp.com/attachments/846689259851350027/1023243233817538570/-_.mp3",
    kazachya = "https://cdn.discordapp.com/attachments/846689259851350027/1023218569628110940/-_.mp3",
    vesno = "https://cdn.discordapp.com/attachments/846689259851350027/1022892288965353512/-_1_1.mp3",
    mao = "https://cdn.discordapp.com/attachments/846689259851350027/1022890606487404584/PRC_propaganda_-_Red_Sun_in_the_Sky.mp3",
    govnovoz = "https://cdn.discordapp.com/attachments/1016746778537758803/1022877170714026004/-_1.mp3",
    trin = "https://cdn.discordapp.com/attachments/846689259851350027/1022598721818591283/-_13-_.mp3",
    rog = "https://cdn.discordapp.com/attachments/846689259851350027/1022597421299150948/-_.mp3",
    omsk = "https://cdn.discordapp.com/attachments/846689259851350027/1022589865143062549/-_.mp3",
    morgenshtern_1 = "https://u.teknik.io/o2Fly.mp3",
    pornhub_intro = "https://cdn.discordapp.com/attachments/974678227362660395/1021517108997259284/Pornhub_.mp3",
    pornhub_2 = "https://cdn.discordapp.com/attachments/974678227362660395/1021562126101393508/DIKIY_KRXT_-_Pornhub_71671016.mp3",
    bs1 = "https://cdn.discordapp.com/attachments/952924658456494111/1023239769074962492/S.T.A.L.K.E.R.-Shadow-of-Chernobyl-Brain-Scorcher-Ambience.mp3",
    pudge = "https://cdn.discordapp.com/attachments/952924658456494111/1066803899031367710/--y---3840x2160.mp3",
    soldierMinus = "https://cdn.discordapp.com/attachments/974678227362660395/1061342876648345713/-__minus.mp3",
    soldierMeme = "https://cdn.discordapp.com/attachments/974678227362660395/1061361274233036933/-_mp3-2020.com.mp3",
    sidorovich_1 = "https://cdn.discordapp.com/attachments/974678227362660395/1062476888334946344/sidorovich-ya-tebya-spas.mp3",
    mc_mom_came_remix = "https://cdn.discordapp.com/attachments/974678227362660395/1069328923114098819/oj-mama-prishla-miss-the-rage_456240694.mp3",
    mc_mom_came = "https://cdn.discordapp.com/attachments/974678227362660395/1069328923491581952/oy-mama-prishla.mp3",
    sanya2 = "https://cdn.discordapp.com/attachments/952924658456494111/1072907650460831745/--__-_saneking.mp4551.mp3",
    morgenshtern_1 = "https://u.teknik.io/o2Fly.mp3",
    pornhub_intro = "https://cdn.discordapp.com/attachments/974678227362660395/1021517108997259284/Pornhub_.mp3",
    pornhub_2 = "https://cdn.discordapp.com/attachments/974678227362660395/1021562126101393508/DIKIY_KRXT_-_Pornhub_71671016.mp3",
    bs1 = "https://cdn.discordapp.com/attachments/1202316619951382598/1238472163783348355/Y2mate.mx_-_FACE_128_kbps.mp3?ex=663f6895&is=663e1715&hm=cda0742e9c7f27e9b64a02978ca76f31ce83d0f9890a121811a7d7f9bd99e318&",
    soldierMinus = "https://cdn.discordapp.com/attachments/974678227362660395/1061342876648345713/-__minus.mp3",
    soldierMeme = "https://cdn.discordapp.com/attachments/974678227362660395/1061361274233036933/-_mp3-2020.com.mp3",
    sidorovich_1 = "https://cdn.discordapp.com/attachments/974678227362660395/1062476888334946344/sidorovich-ya-tebya-spas.mp3",
    stalker_1 = "https://cdn.discordapp.com/attachments/900794622878564362/1025497202094776320/100_.mp3",
    mc_mom_came_remix = "https://cdn.discordapp.com/attachments/974678227362660395/1069328923114098819/oj-mama-prishla-miss-the-rage_456240694.mp3",
    mc_mom_came = "https://cdn.discordapp.com/attachments/974678227362660395/1069328923491581952/oy-mama-prishla.mp3",
    starwars_duel_sudeb = "https://cdn.discordapp.com/attachments/974678227362660395/1074700721880047758/zvezdnie_vojni_-_duel_sudeb_z2.fm.mp3",
    tak_nravits9 = "https://cdn.discordapp.com/attachments/974678227362660395/1075423243604856903/-_.mp3",
    screamer = "https://cdn.discordapp.com/attachments/1081967820172181578/1099705174836129912/-_.mp3",
    aahh = "https://cdn.discordapp.com/attachments/974678227362660395/1100475849314148442/onlymp3.to_-_AUUGHHH_Sound_Effect-srodNyimqTM-256k-1654135608956.mp3",
    wither_storm = "https://cdn.discordapp.com/attachments/974678227362660395/1101220414325280798/SnapInsta.io_-_Wither_Storm_-_FULL_GAME_MUSIC_128_kbps.mp3",
    a = "https://cdn.discordapp.com/attachments/1202316619951382598/1238470408215335024/Y2mate.mx_-_Circus_Theme_Song_320_kbps.mp3?ex=663f66f2&is=663e1572&hm=3f0ebc72bf94bffaa161db57d435782e9a493e900538341b129dfdfb5dd26a9c&",
}


-- =================================================================================


if SERVER then
    
    local WW = chip():getWirelink()
    
    wire.adjustPorts(
        {
            ON="number",
        },
        {
        }
    )
    
    hook.add("input", "", function(input_name, value) 
        if input_name == 'ON' then
            net.start("Active")
            net.writeBool(value != 0 and true or false)
            net.send()
        end
    end)
    
    hook.add("ClientInitialized", "cl_init", function(ply)
        net.start("Active")
        net.writeBool(!WW:isWired('ON') or wire.ports.ON != 0)
        net.send(ply)
    end)
    
    return
end

---------------

local _isActive = false
local _sound
local _eyePos = Vector()

hook.add("renderscene", "", function(origin, angles, fov)
    _eyePos = origin
end)

net.receive("Active", function(len)
    _isActive = net.readBool()
    if isValid(_sound) then
        if _isActive then
            _sound:play()
        else
            _sound:pause()
            if RestartAfterPause then
                _sound:setTime(StartTime)
            end
        end
    end
end)


bass.loadURL(_urls[URL], "3d noblock noplay", function(Sound)
    _sound = Sound
    _sound:setLooping(IsLooping)
    _sound:setPitch(Speed)
    
    timer.simple(0.5, function()
        _sound:setTime(StartTime)
        if _isActive then
            _sound:play()
        else
            _sound:pause()
        end
    end)
    
    hook.add("think", "", function()
        if IsAllServer then
            _sound:setVolume(Volume)
        else
            local distance = chip():getPos():getDistance(_eyePos)
            _sound:setVolume(math.min(1, ((Radius-distance) / Radius)) * Volume)
        end
        local dirSound = (chip():getPos() - _eyePos):getNormalized()
        _sound:setPos(_eyePos + dirSound*100)
    end)
        
end)

local mat = material.load("voice/icntlk_sv")

--     
local function rainbowColor(time)
    local r = math.floor(math.sin(time) * 127 + 128)
    local g = math.floor(math.sin(time + 2) * 127 + 128)
    local b = math.floor(math.sin(time + 4) * 127 + 128)
    return Color(r, g, b)
end

timer.create("throwVoice", 0.3, 0, function()
    local chipPos = chip():getPos() + Vector(0, 0, 19)
    local emit = particle.create(chipPos, false)
    local time = timer.curtime() * 5 --    

    local part = emit:add(mat, chipPos, 5, 0, 0, 0, 255, 255, 2)
    if part then
        part:setColor(rainbowColor(time)) --   
        part:setVelocity(Vector(math.random(-1, 1), math.random(-1, 1), 3):getNormalized() * 100)
        part:setGravity(Vector(0, 0, -150))
        part:setCollide(true)
        part:setBounce(0.75)
    end
    emit:destroy()
end)
